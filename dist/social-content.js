(()=>{function e(e,t){let o;return function(...n){clearTimeout(o),o=setTimeout((()=>{clearTimeout(o),e(...n)}),t)}}console.log("Social content script loaded");let t,o,n=!1,s=!1,a=null;function r(){document.querySelectorAll(".image-overlay").forEach((e=>e.remove()))}async function i(){try{const e=await new Promise(((e,t)=>{chrome.storage.sync.get(["enableOverlay","facebook","twitter","instagram","linkedin","reddit"],(o=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e(o)}))}));return n=!1!==e.enableOverlay,s=!1!==e[a],n&&s}catch(e){return console.error("Error in shouldProcessImage:",e),!1}}async function c(){if(!await i())return void r();const e=[];(function t(o){o.nodeType===Node.ELEMENT_NODE&&("img"!==o.tagName.toLowerCase()||o.dataset.overlayProcessed||e.push(o),o.shadowRoot&&t(o.shadowRoot),o.childNodes.forEach((e=>t(e))))})(document.body),"instagram"===a&&document.querySelectorAll('img[srcset], img[src*="instagram"]').forEach((t=>{t.dataset.overlayProcessed||e.push(t)})),"reddit"===a&&document.querySelectorAll('img[alt="Post image"]').forEach((t=>e.push(t))),e.forEach(((e,t)=>{if(e.width>50&&e.height>50||e.getAttribute("width")>50&&e.getAttribute("height")>50||e.classList.contains("media-lightbox-img"))try{e.complete&&e.naturalWidth>0?l(e):e.addEventListener("load",(()=>{l(e)}),{once:!0})}catch(e){console.error("Error processing image:",e)}else e.dataset.overlayProcessed="skipped"}))}function l(e,t){if("true"===e.dataset.overlayProcessed)return;const o=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&((e.width>100&&e.height>100||"video"===e.tagName.toLowerCase())&&d(e),o.unobserve(e))}))}),{threshold:.1});o.observe(e),e.dataset.overlayProcessed="true",e.onerror=function(){},e.onload=function(){(e.width>100&&e.height>100||"video"===e.tagName.toLowerCase())&&d(e)}}function d(t,o){let n=document.querySelector(`.image-overlay[data-for-image="${t.src}"]`);n||(n=document.createElement("div"),n.className="image-overlay",n.dataset.forImage=t.src,n.style.cssText="\n        position: absolute;\n        width: 30px;\n        height: 30px;\n        background-color: rgba(255, 255, 255, 0.4);\n        border-radius: 50%;\n        cursor: pointer;\n        z-index: 2147483647;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 20px;\n        pointer-events: auto;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n        opacity: 0.5;\n        transition: opacity 0.3s ease, background-color 0.3s ease, display 0.3s ease;\n      ",n.textContent="ðŸ§¿",n.onclick=o=>{o.stopPropagation(),o.preventDefault();const s=function(e){if("instagram"===a){const t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight,t.getContext("2d").drawImage(e,0,0);try{return t.toDataURL("image/jpeg")}catch(t){return console.error("Failed to get image data:",t),e.src}}const t=e.src;let o=t;if("linkedin"===a){if(null!==e.closest(".feed-shared-celebration-image"))return t;try{const e=new URL(t),n=e.pathname;e.searchParams.delete("w"),e.searchParams.delete("h"),e.searchParams.set("w","1000"),e.searchParams.set("h","1000"),o=e.toString();const s=n.split(".").pop().toLowerCase();["jpg","jpeg","png","gif","webp"].includes(s)&&(o.toLowerCase().endsWith(`.${s}`)||(o+=`.${s}`))}catch(e){console.error("Failed to parse LinkedIn image URL:",e),o=t}}else if("instagram"===a&&t.includes("&_nc_ht="))try{const e=new URL(t);e.searchParams.delete("_nc_sid"),e.searchParams.delete("_nc_ohc"),e.searchParams.delete("_nc_ht"),e.searchParams.delete("edm"),e.searchParams.delete("oh"),e.searchParams.delete("oe"),o=e.toString()}catch(e){console.error("Failed to parse Instagram image URL:",e)}return o}(t);s?function(t,o){u("Showing consent popup for target:",t);const n=document.querySelector(`.consent-popup[data-for-image="${o}"]`);if(n)return n;document.querySelectorAll(".consent-popup:not([data-for-image='"+o+"'])").forEach((e=>e.remove()));const s=document.createElement("div");s.className="consent-popup",s.setAttribute("data-for-image",o),s.innerHTML='\n      <p class="consent-message">Send Image for Analysis?</p>\n      <div class="consent-buttons">\n        <button class="confirm-btn">Analyze Image</button>\n        <button class="cancel-btn">Cancel</button>\n      </div>\n      <div class="consent-options">\n        <label class="store-data-option">\n          <input type="checkbox" class="store-data-checkbox" id="storeImageData" checked>\n          <span>Allow storing image data for research and model improvement</span>\n        </label>\n      </div>\n    ',document.body.appendChild(s);const a=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting?(s.style.display="flex",r()):s.style.display="none"}))}),{threshold:.1});a.observe(t);const r=()=>{if("none"===s.style.display)return;const e=t.getBoundingClientRect();u("Overlay rect:",e);let o=e.right+window.pageXOffset+10,n=e.top+window.pageYOffset;o+s.offsetWidth>window.innerWidth-10+window.pageXOffset&&(o=e.left+window.pageXOffset-s.offsetWidth-10);const a=window.innerHeight+window.pageYOffset-s.offsetHeight-10;n=Math.max(10+window.pageYOffset,Math.min(n,a)),u("Setting popup position:",{left:o,top:n}),s.style.position="absolute",s.style.left=`${o}px`,s.style.top=`${n}px`};setTimeout(r,0);const i=e(r,100);window.addEventListener("resize",i),window.addEventListener("scroll",i);const c=()=>{u("Cleaning up popup"),window.removeEventListener("resize",i),window.removeEventListener("scroll",i),a.disconnect(),s.remove()};s.querySelector(".confirm-btn")?.addEventListener("click",c),s.querySelector(".cancel-btn")?.addEventListener("click",c)}(n,s):function(){const e=document.createElement("div");e.textContent="No suitable image found.",e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.padding="10px 20px",e.style.borderRadius="5px",e.style.color="#fff",e.style.zIndex="10000",e.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.2)",e.style.opacity="0",e.style.transition="opacity 0.5s ease-in-out",e.style.backgroundColor="#f44336",document.body.appendChild(e),e.offsetWidth,e.style.opacity="1",setTimeout((()=>{e.style.opacity="0",e.addEventListener("transitionend",(()=>{e.remove()}))}),3e3)}()},t.parentElement.appendChild(n),n.addEventListener("mouseenter",(()=>{n.style.opacity="1",n.style.backgroundColor="rgba(255, 255, 255, 0.8)"})),n.addEventListener("mouseleave",(()=>{n.style.opacity="0.5",n.style.backgroundColor="rgba(255, 255, 255, 0.4)"})));const s=e((()=>{const e=t.getBoundingClientRect(),o=window.innerHeight,s=window.innerWidth,a=e.top<o&&e.bottom>0&&e.left<s&&e.right>0,r=null!==t.closest(".media-lightbox-img"),i="video"===t.tagName.toLowerCase()||t.querySelector("video");if(!a||!(e.width>100&&e.height>100||i)||r&&null===t.offsetParent)i?(n.style.display="flex",n.style.top="10px",n.style.right="10px",n.style.bottom="auto",n.style.left="auto"):setTimeout((()=>{a||(n.style.display="none")}),300);else{n.style.display="flex";const e=10,t=10;n.style.top=`${e}px`,n.style.right=`${t}px`,n.style.bottom="auto",n.style.left="auto"}}),100);if(s(),!t.dataset.overlayEventListenersAdded){const e=()=>{s()},o=()=>{s()};window.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",o,{passive:!0}),t.dataset.overlayEventListenersAdded="true"}new MutationObserver((e=>{e.forEach((e=>{"attributes"!==e.type||"src"!==e.attributeName&&"style"!==e.attributeName||(n.dataset.forImage=t.src,s())}))})).observe(t,{attributes:!0,attributeFilter:["src","style"]})}function u(e,...t){console.log(`[RealEyes Debug] ${e}`,...t)}const m=e(c,500);function p(e){for(const t of e)if(("childList"===t.type||"attributes"===t.type)&&(t.addedNodes.length>0||"attributes"===t.type&&"src"===t.attributeName)){clearTimeout(f),f=setTimeout((()=>{c()}),v);break}}function g(){document.querySelectorAll("img:not([data-overlay-processed])").forEach(((e,t)=>l(e)))}async function y(){if(!chrome.runtime||!chrome.runtime.id)return;const d=window.location.hostname;a=d.includes("linkedin.com")?"linkedin":d.includes("facebook.com")?"facebook":d.includes("twitter.com")||d.includes("x.com")?"twitter":d.includes("instagram.com")?"instagram":d.includes("reddit.com")?"reddit":null,a&&(await i()?(n=!0,s=!0,async function(){await i()&&c()}(),t=new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&e.addedNodes.forEach((e=>{e.nodeType===Node.ELEMENT_NODE&&e.querySelectorAll("img:not([data-overlay-processed])").forEach(((e,t)=>l(e)))}))}))})),t.observe(document.body,{childList:!0,subtree:!0}),setInterval(g,2e3),window.addEventListener("scroll",e((()=>{c()}),200)),o=new MutationObserver(p),o.observe(document.body,{childList:!0,subtree:!0})):(n=!1,s=!1,r(),t&&t.disconnect(),o&&o.disconnect(),window.removeEventListener("scroll",m)))}setInterval((function(){chrome.runtime.id||location.reload()}),6e4),chrome.runtime.onMessage.addListener(((e,t,o)=>{return console.log("Message received in social content script:",e),"settingsChanged"===e.action&&(console.log("Settings changed:",e.changes),i=e.changes,console.log("Updating settings in content script:",i),i.enableOverlay&&(n=i.enableOverlay.newValue),y(),o({success:!0})),"updateSettings"===e.action&&(r=e.settings,n=!1!==r.enableOverlay,s=!1!==r[a],n&&s?(document.querySelectorAll(".image-overlay").forEach((e=>{e.style.display="flex"})),c()):document.querySelectorAll(".image-overlay").forEach((e=>{e.style.display="none"})),o({status:"Settings updated"})),!0;var r,i})),y();const h=document.createElement("style");let f;h.innerHTML="\n    .overlay:state(secondary-text-color) {\n      color: var(--secondary-text-color);\n    }\n    \n    .image-fill:state(webkit-fill-available) {\n      width: -webkit-fill-available;\n    }\n  ",document.head.appendChild(h);const v=300;window.addEventListener("error",(e=>{var t;t=e.error,console.error("RealEyes.ai Extension Error:",t)}))})();
//# sourceMappingURL=social-content.js.map