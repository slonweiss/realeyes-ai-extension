{"version":3,"file":"popup.js","mappings":"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","sources":["webpack://chrome-gmail-poc/./src/popup.js"],"sourcesContent":["document.addEventListener(\"DOMContentLoaded\", function () {\n  const loginContainer = document.getElementById(\"loginContainer\");\n  const settingsContainer = document.getElementById(\"settingsContainer\");\n  const enableOverlayToggle = document.getElementById(\"enableOverlay\");\n  const siteToggles = [\n    \"facebook\",\n    \"twitter\",\n    \"instagram\",\n    \"linkedin\",\n    \"reddit\",\n  ];\n  const settingsContent = document.getElementById(\"settingsContent\");\n  const loginButton = document.getElementById(\"login\");\n  const saveButton = document.getElementById(\"save\");\n\n  console.log(\"Popup script loaded\");\n\n  function logAllStorageData() {\n    chrome.storage.local.get(null, function (items) {\n      console.log(\n        \"All stored data (from popup):\",\n        JSON.stringify(items, null, 2)\n      );\n    });\n  }\n\n  // Log storage when popup opens\n  logAllStorageData();\n\n  function checkAuthentication() {\n    return new Promise((resolve) => {\n      chrome.storage.local.get([\"authToken\"], function (result) {\n        console.log(\"Auth token check result:\", result);\n        resolve(!!result.authToken);\n      });\n    });\n  }\n\n  checkAuthentication().then((isAuthenticated) => {\n    console.log(\"Authentication check result:\", isAuthenticated);\n    if (isAuthenticated) {\n      showSettings();\n    } else {\n      showLogin();\n    }\n  });\n\n  function showLogin() {\n    console.log(\"Showing login\");\n    loginContainer.style.display = \"block\";\n    settingsContainer.style.display = \"none\";\n  }\n\n  function showSettings() {\n    console.log(\"Showing settings\");\n    loginContainer.style.display = \"none\";\n    settingsContainer.style.display = \"block\";\n    loadSavedSettings();\n  }\n\n  // Load saved settings\n  function loadSavedSettings() {\n    chrome.storage.sync.get(\n      [\n        \"enableOverlay\",\n        \"facebook\",\n        \"twitter\",\n        \"instagram\",\n        \"linkedin\",\n        \"reddit\",\n      ],\n      function (items) {\n        enableOverlayToggle.checked = items.enableOverlay !== false;\n        siteToggles.forEach((site) => {\n          document.getElementById(site).checked = items[site] !== false;\n        });\n        updateToggleStates();\n        updateContentScript(items);\n      }\n    );\n  }\n\n  // Function to update content script\n  function updateContentScript(settings) {\n    chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {\n      if (tabs[0]) {\n        chrome.tabs.sendMessage(\n          tabs[0].id,\n          { action: \"updateSettings\", settings: settings },\n          function (response) {\n            if (chrome.runtime.lastError) {\n              console.log(\n                \"Content script not found in tab. Injecting content script.\"\n              );\n              chrome.scripting.executeScript(\n                {\n                  target: { tabId: tabs[0].id },\n                  files: [\"social-content.js\"],\n                },\n                () => {\n                  // Retry sending the message after injecting the script\n                  chrome.tabs.sendMessage(\n                    tabs[0].id,\n                    { action: \"updateSettings\", settings: settings },\n                    (response) => {\n                      if (chrome.runtime.lastError) {\n                        console.error(\n                          \"Error after injecting content script:\",\n                          chrome.runtime.lastError.message\n                        );\n                      } else {\n                        console.log(\n                          \"Settings updated in content script after injection\"\n                        );\n                      }\n                    }\n                  );\n                }\n              );\n            } else {\n              console.log(\"Settings updated in content script\");\n            }\n          }\n        );\n      } else {\n        console.log(\"No active tab found\");\n        // Handle the case when there's no active tab\n      }\n    });\n  }\n\n  // Function to update toggle states\n  function updateToggleStates() {\n    const isOverlayEnabled = enableOverlayToggle.checked;\n\n    if (isOverlayEnabled) {\n      settingsContent.classList.remove(\"disabled-section\");\n    } else {\n      settingsContent.classList.add(\"disabled-section\");\n    }\n\n    siteToggles.forEach((site) => {\n      const siteToggle = document.getElementById(site);\n      siteToggle.disabled = !isOverlayEnabled;\n    });\n  }\n\n  // Event listener for login button\n  if (loginButton) {\n    loginButton.addEventListener(\"click\", function () {\n      console.log(\"Login button clicked\");\n      chrome.runtime.sendMessage({ action: \"initiateAuthentication\" });\n      window.close(); // Close the popup after initiating login\n    });\n  } else {\n    console.error(\"Login button not found\");\n  }\n\n  // Event listener for enable overlay toggle\n  if (enableOverlayToggle) {\n    enableOverlayToggle.addEventListener(\"change\", updateToggleStates);\n  } else {\n    console.error(\"Enable overlay toggle not found\");\n  }\n\n  // Event listener for save button\n  if (saveButton) {\n    saveButton.addEventListener(\"click\", function () {\n      console.log(\"Save settings button clicked\");\n      const settings = {\n        enableOverlay: enableOverlayToggle.checked,\n      };\n\n      siteToggles.forEach((site) => {\n        const siteToggle = document.getElementById(site);\n        settings[site] = siteToggle.checked;\n      });\n\n      chrome.storage.sync.set(settings, function () {\n        console.log(\"Settings saved\");\n        saveButton.textContent = \"Saved!\";\n        saveButton.classList.add(\"success\");\n        setTimeout(() => {\n          saveButton.textContent = \"Save Settings\";\n          saveButton.classList.remove(\"success\");\n        }, 2000);\n\n        updateContentScript(settings);\n      });\n    });\n  } else {\n    console.error(\"Save button not found\");\n  }\n\n  // Check for authentication status changes\n  chrome.storage.onChanged.addListener(function (changes, namespace) {\n    if (namespace === \"local\" && changes.authToken) {\n      if (changes.authToken.newValue) {\n        showSettings();\n      } else {\n        showLogin();\n      }\n    }\n  });\n});\n"],"names":["document","addEventListener","loginContainer","getElementById","settingsContainer","enableOverlayToggle","siteToggles","settingsContent","loginButton","saveButton","showLogin","console","log","style","display","showSettings","chrome","storage","sync","get","items","checked","enableOverlay","forEach","site","updateToggleStates","updateContentScript","settings","tabs","query","active","currentWindow","sendMessage","id","action","response","runtime","lastError","scripting","executeScript","target","tabId","files","error","message","isOverlayEnabled","classList","remove","add","disabled","local","JSON","stringify","Promise","resolve","result","authToken","then","isAuthenticated","window","close","siteToggle","set","textContent","setTimeout","onChanged","addListener","changes","namespace","newValue"],"sourceRoot":""}