document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("loginContainer"),t=document.getElementById("settingsContainer"),o=document.getElementById("enableOverlay"),n=["facebook","twitter","instagram","linkedin","reddit"],s=document.getElementById("settingsContent"),c=document.getElementById("login"),i=document.getElementById("save"),a=document.getElementById("logoutButton");function l(){console.log("Showing login"),e.style.display="block",t.style.display="none"}function r(){console.log("Showing settings"),e.style.display="none",t.style.display="block",chrome.storage.sync.get(["enableOverlay","facebook","twitter","instagram","linkedin","reddit"],(function(e){o.checked=!1!==e.enableOverlay,n.forEach((t=>{document.getElementById(t).checked=!1!==e[t]})),u(),d(e)}))}function d(e){chrome.tabs.query({active:!0,currentWindow:!0},(function(t){if(t[0]){if(t[0].url.startsWith("chrome://")||t[0].url.startsWith("chrome-extension://"))return void console.log("Skipping protected URL:",t[0].url);chrome.tabs.sendMessage(t[0].id,{action:"updateSettings",settings:e},(function(o){chrome.runtime.lastError?(console.log("Content script not found in tab. Injecting content script."),chrome.scripting.executeScript({target:{tabId:t[0].id},files:["social-content.js"]},(()=>{chrome.runtime.lastError?console.log("Cannot inject script into this tab:",chrome.runtime.lastError.message):chrome.tabs.sendMessage(t[0].id,{action:"updateSettings",settings:e},(e=>{chrome.runtime.lastError?console.log("Error after injecting content script:",chrome.runtime.lastError.message):console.log("Settings updated in content script after injection")}))}))):console.log("Settings updated in content script")}))}else console.log("No active tab found")}))}function u(){const e=o.checked;e?s.classList.remove("disabled-section"):s.classList.add("disabled-section"),n.forEach((t=>{document.getElementById(t).disabled=!e}))}console.log("Popup script loaded"),chrome.storage.local.get(null,(function(e){console.log("All stored data (from popup):",JSON.stringify(e,null,2))})),new Promise((e=>{chrome.cookies.get({url:"https://realeyes.ai",name:"opp_access_token"},(t=>{t&&t.value?chrome.storage.local.set({authToken:t.value},(()=>{console.log("Auth token set from existing cookie"),e(!0)})):chrome.storage.local.get(["authToken"],(function(t){console.log("No cookie found, checking local storage:",t),e(!!t.authToken)}))}))})).then((e=>{console.log("Authentication check result:",e),e?r():l()})),c?c.addEventListener("click",(async function(){console.log("Login button clicked"),await new Promise((e=>{chrome.cookies.get({url:"https://realeyes.ai",name:"opp_access_token"},(t=>{t&&t.value?chrome.storage.local.set({authToken:t.value},(()=>{console.log("Auth token set from existing cookie"),e(!0)})):e(!1)}))}))?r():(chrome.tabs.create({url:"https://realeyes.ai/upload-image"}),window.close())})):console.error("Login button not found"),o?o.addEventListener("change",u):console.error("Enable overlay toggle not found"),i?i.addEventListener("click",(function(){console.log("Save settings button clicked");const e={enableOverlay:o.checked};n.forEach((t=>{const o=document.getElementById(t);e[t]=o.checked})),chrome.storage.sync.set(e,(function(){console.log("Settings saved"),i.textContent="Saved!",i.classList.add("success"),setTimeout((()=>{i.textContent="Save Settings",i.classList.remove("success")}),2e3),d(e)}))})):console.error("Save button not found"),chrome.storage.onChanged.addListener((function(e,t){"local"===t&&e.authToken&&(e.authToken.newValue?r():l())})),a&&a.addEventListener("click",(function(){chrome.storage.local.remove("authToken",(function(){console.log("Auth token removed"),chrome.cookies.remove({url:"https://realeyes.ai",name:"opp_access_token"},(function(e){const t=new URL("https://signin.realeyes.ai/logout");t.searchParams.append("client_id","49nfihgrtdm78kf6su5brla4o5"),t.searchParams.append("logout_uri","https://realeyes.ai"),chrome.tabs.create({url:t.toString()}),window.close()}))}))}))}));
//# sourceMappingURL=popup.js.map