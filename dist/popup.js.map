{"version":3,"file":"popup.js","mappings":"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","sources":["webpack://chrome-gmail-poc/./src/popup.js"],"sourcesContent":["document.addEventListener(\"DOMContentLoaded\", function () {\n  const loginContainer = document.getElementById(\"loginContainer\");\n  const settingsContainer = document.getElementById(\"settingsContainer\");\n  const enableOverlayToggle = document.getElementById(\"enableOverlay\");\n  const siteToggles = [\n    \"facebook\",\n    \"twitter\",\n    \"instagram\",\n    \"linkedin\",\n    \"reddit\",\n  ];\n  const settingsContent = document.getElementById(\"settingsContent\");\n  const loginButton = document.getElementById(\"login\");\n  const saveButton = document.getElementById(\"save\");\n  const logoutButton = document.getElementById(\"logoutButton\");\n\n  console.log(\"Popup script loaded\");\n\n  function logAllStorageData() {\n    chrome.storage.local.get(null, function (items) {\n      console.log(\n        \"All stored data (from popup):\",\n        JSON.stringify(items, null, 2)\n      );\n    });\n  }\n\n  // Log storage when popup opens\n  logAllStorageData();\n\n  function checkAuthentication() {\n    return new Promise((resolve) => {\n      chrome.storage.local.get([\"authToken\"], function (result) {\n        console.log(\"Auth token check result:\", result);\n        resolve(!!result.authToken);\n      });\n    });\n  }\n\n  checkAuthentication().then((isAuthenticated) => {\n    console.log(\"Authentication check result:\", isAuthenticated);\n    if (isAuthenticated) {\n      showSettings();\n    } else {\n      showLogin();\n    }\n  });\n\n  function checkExistingCookie() {\n    return new Promise((resolve) => {\n      chrome.cookies.get(\n        {\n          url: \"https://realeyes.ai\",\n          name: \"opp_access_token\",\n        },\n        (cookie) => {\n          if (cookie && cookie.value) {\n            // Store the cookie value as authToken\n            chrome.storage.local.set({ authToken: cookie.value }, () => {\n              console.log(\"Auth token set from existing cookie\");\n              resolve(true);\n            });\n          } else {\n            resolve(false);\n          }\n        }\n      );\n    });\n  }\n\n  function showLogin() {\n    console.log(\"Showing login\");\n    loginContainer.style.display = \"block\";\n    settingsContainer.style.display = \"none\";\n  }\n\n  function showSettings() {\n    console.log(\"Showing settings\");\n    loginContainer.style.display = \"none\";\n    settingsContainer.style.display = \"block\";\n    loadSavedSettings();\n  }\n\n  // Load saved settings\n  function loadSavedSettings() {\n    chrome.storage.sync.get(\n      [\n        \"enableOverlay\",\n        \"facebook\",\n        \"twitter\",\n        \"instagram\",\n        \"linkedin\",\n        \"reddit\",\n      ],\n      function (items) {\n        enableOverlayToggle.checked = items.enableOverlay !== false;\n        siteToggles.forEach((site) => {\n          document.getElementById(site).checked = items[site] !== false;\n        });\n        updateToggleStates();\n        updateContentScript(items);\n      }\n    );\n  }\n\n  // Function to update content script\n  function updateContentScript(settings) {\n    chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {\n      if (tabs[0]) {\n        chrome.tabs.sendMessage(\n          tabs[0].id,\n          { action: \"updateSettings\", settings: settings },\n          function (response) {\n            if (chrome.runtime.lastError) {\n              console.log(\n                \"Content script not found in tab. Injecting content script.\"\n              );\n              chrome.scripting.executeScript(\n                {\n                  target: { tabId: tabs[0].id },\n                  files: [\"social-content.js\"],\n                },\n                () => {\n                  // Retry sending the message after injecting the script\n                  chrome.tabs.sendMessage(\n                    tabs[0].id,\n                    { action: \"updateSettings\", settings: settings },\n                    (response) => {\n                      if (chrome.runtime.lastError) {\n                        console.error(\n                          \"Error after injecting content script:\",\n                          chrome.runtime.lastError.message\n                        );\n                      } else {\n                        console.log(\n                          \"Settings updated in content script after injection\"\n                        );\n                      }\n                    }\n                  );\n                }\n              );\n            } else {\n              console.log(\"Settings updated in content script\");\n            }\n          }\n        );\n      } else {\n        console.log(\"No active tab found\");\n        // Handle the case when there's no active tab\n      }\n    });\n  }\n\n  // Function to update toggle states\n  function updateToggleStates() {\n    const isOverlayEnabled = enableOverlayToggle.checked;\n\n    if (isOverlayEnabled) {\n      settingsContent.classList.remove(\"disabled-section\");\n    } else {\n      settingsContent.classList.add(\"disabled-section\");\n    }\n\n    siteToggles.forEach((site) => {\n      const siteToggle = document.getElementById(site);\n      siteToggle.disabled = !isOverlayEnabled;\n    });\n  }\n\n  // Event listener for login button\n  if (loginButton) {\n    loginButton.addEventListener(\"click\", async function () {\n      console.log(\"Login button clicked\");\n      const hasCookie = await checkExistingCookie();\n      if (hasCookie) {\n        showSettings();\n      } else {\n        chrome.tabs.create({ url: \"https://realeyes.ai/upload-image\" });\n        window.close();\n      }\n    });\n  } else {\n    console.error(\"Login button not found\");\n  }\n\n  // Event listener for enable overlay toggle\n  if (enableOverlayToggle) {\n    enableOverlayToggle.addEventListener(\"change\", updateToggleStates);\n  } else {\n    console.error(\"Enable overlay toggle not found\");\n  }\n\n  // Event listener for save button\n  if (saveButton) {\n    saveButton.addEventListener(\"click\", function () {\n      console.log(\"Save settings button clicked\");\n      const settings = {\n        enableOverlay: enableOverlayToggle.checked,\n      };\n\n      siteToggles.forEach((site) => {\n        const siteToggle = document.getElementById(site);\n        settings[site] = siteToggle.checked;\n      });\n\n      chrome.storage.sync.set(settings, function () {\n        console.log(\"Settings saved\");\n        saveButton.textContent = \"Saved!\";\n        saveButton.classList.add(\"success\");\n        setTimeout(() => {\n          saveButton.textContent = \"Save Settings\";\n          saveButton.classList.remove(\"success\");\n        }, 2000);\n\n        updateContentScript(settings);\n      });\n    });\n  } else {\n    console.error(\"Save button not found\");\n  }\n\n  // Check for authentication status changes\n  chrome.storage.onChanged.addListener(function (changes, namespace) {\n    if (namespace === \"local\" && changes.authToken) {\n      if (changes.authToken.newValue) {\n        showSettings();\n      } else {\n        showLogin();\n      }\n    }\n  });\n\n  // Add logout button handler\n  if (logoutButton) {\n    logoutButton.addEventListener(\"click\", function () {\n      // Clear local storage auth token\n      chrome.storage.local.remove(\"authToken\", function () {\n        console.log(\"Auth token removed\");\n\n        // Construct logout URL with proper endpoint\n        const logoutUrl = new URL(\"https://signin.realeyes.ai/logout\");\n        logoutUrl.searchParams.append(\n          \"client_id\",\n          \"49nfihgrtdm78kf6su5brla4o5\"\n        );\n        logoutUrl.searchParams.append(\"logout_uri\", \"https://realeyes.ai\");\n\n        // Open logout URL in new tab and close popup\n        chrome.tabs.create({ url: logoutUrl.toString() });\n        window.close();\n      });\n    });\n  }\n});\n"],"names":["document","addEventListener","loginContainer","getElementById","settingsContainer","enableOverlayToggle","siteToggles","settingsContent","loginButton","saveButton","logoutButton","showLogin","console","log","style","display","showSettings","chrome","storage","sync","get","items","checked","enableOverlay","forEach","site","updateToggleStates","updateContentScript","settings","tabs","query","active","currentWindow","sendMessage","id","action","response","runtime","lastError","scripting","executeScript","target","tabId","files","error","message","isOverlayEnabled","classList","remove","add","disabled","local","JSON","stringify","Promise","resolve","result","authToken","then","isAuthenticated","async","cookies","url","name","cookie","value","set","create","window","close","siteToggle","textContent","setTimeout","onChanged","addListener","changes","namespace","newValue","logoutUrl","URL","searchParams","append","toString"],"sourceRoot":""}