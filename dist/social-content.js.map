{"version":3,"file":"social-content.js","mappings":"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","sources":["webpack://chrome-gmail-poc/./src/social-content.js"],"sourcesContent":["(() => {\n  // At the top of the file, add:\n  console.log(\"Social content script loaded\");\n\n  // Utility function to debounce frequent function calls\n  function debounce(func, wait) {\n    let timeout;\n    return function executedFunction(...args) {\n      const later = () => {\n        clearTimeout(timeout);\n        func(...args);\n      };\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n    };\n  }\n\n  // Global variables\n  let extensionEnabled = false;\n  let siteEnabled = false;\n  let currentSite = null;\n\n  let retryCount = 0;\n  const MAX_RETRIES = 5;\n  const INITIAL_RETRY_DELAY = 1000; // 1 second\n\n  let bodyObserver;\n  let observer;\n\n  // Remove all overlay elements from the page\n  function removeAllOverlays() {\n    const overlays = document.querySelectorAll(\".image-overlay\");\n    overlays.forEach((overlay) => overlay.remove());\n  }\n\n  // Check if image processing should occur based on user settings\n  async function shouldProcessImage() {\n    try {\n      const items = await new Promise((resolve, reject) => {\n        chrome.storage.sync.get(\n          [\n            \"enableOverlay\",\n            \"facebook\",\n            \"twitter\",\n            \"instagram\",\n            \"linkedin\",\n            \"reddit\",\n          ],\n          (items) => {\n            if (chrome.runtime.lastError) {\n              reject(chrome.runtime.lastError);\n            } else {\n              resolve(items);\n            }\n          }\n        );\n      });\n\n      extensionEnabled = items.enableOverlay !== false;\n      siteEnabled = items[currentSite] !== false;\n\n      return extensionEnabled && siteEnabled;\n    } catch (error) {\n      console.error(\"Error in shouldProcessImage:\", error);\n      return false;\n    }\n  }\n\n  // Main function to add or update overlays on images\n  async function addOrUpdateOverlayToImages() {\n    const shouldProcess = await shouldProcessImage();\n    if (!shouldProcess) {\n      removeAllOverlays();\n      return;\n    }\n\n    const allImages = [];\n\n    // Recursive function to traverse DOM and shadow DOM\n    function traverse(node) {\n      if (node.nodeType !== Node.ELEMENT_NODE) return;\n      if (\n        node.tagName.toLowerCase() === \"img\" &&\n        !node.dataset.overlayProcessed\n      ) {\n        allImages.push(node);\n      }\n\n      if (node.shadowRoot) {\n        traverse(node.shadowRoot);\n      }\n\n      node.childNodes.forEach((child) => traverse(child));\n    }\n\n    traverse(document.body);\n\n    // Special handling for Instagram\n    if (currentSite === \"instagram\") {\n      const instagramImages = document.querySelectorAll(\n        'img[srcset], img[src*=\"instagram\"]'\n      );\n      instagramImages.forEach((img) => {\n        if (!img.dataset.overlayProcessed) {\n          allImages.push(img);\n        }\n      });\n    }\n\n    // Special handling for Reddit\n    if (currentSite === \"reddit\") {\n      const redditImages = document.querySelectorAll('img[alt=\"Post image\"]');\n      redditImages.forEach((img) => allImages.push(img));\n    }\n\n    // Process each image\n    allImages.forEach((img, index) => {\n      if (\n        (img.width > 50 && img.height > 50) ||\n        (img.getAttribute(\"width\") > 50 && img.getAttribute(\"height\") > 50) ||\n        img.classList.contains(\"media-lightbox-img\")\n      ) {\n        try {\n          if (img.complete && img.naturalWidth > 0) {\n            processImage(img, index);\n          } else {\n            img.addEventListener(\n              \"load\",\n              () => {\n                processImage(img, index);\n              },\n              { once: true }\n            );\n          }\n        } catch (error) {\n          console.error(\"Error processing image:\", error);\n        }\n      } else {\n        img.dataset.overlayProcessed = \"skipped\";\n      }\n    });\n  }\n\n  // Process individual image\n  function processImage(img, index) {\n    if (img.dataset.overlayProcessed === \"true\") {\n      return;\n    }\n\n    // Use Intersection Observer to detect when image is in viewport\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            if (\n              (img.width > 100 && img.height > 100) ||\n              img.tagName.toLowerCase() === \"video\"\n            ) {\n              addOrUpdateOverlayToImage(img, index);\n            }\n            observer.unobserve(img);\n          }\n        });\n      },\n      { threshold: 0.1 }\n    );\n\n    observer.observe(img);\n\n    img.dataset.overlayProcessed = \"true\";\n\n    // Error handling for image loading\n    img.onerror = function () {\n      // Error handling logic here if needed\n    };\n\n    // Handle successful image load\n    img.onload = function () {\n      if (\n        (img.width > 100 && img.height > 100) ||\n        img.tagName.toLowerCase() === \"video\"\n      ) {\n        addOrUpdateOverlayToImage(img, index);\n      }\n    };\n  }\n\n  // Add or update overlay on an image\n  function addOrUpdateOverlayToImage(img, index) {\n    let overlay = document.querySelector(\n      `.image-overlay[data-for-image=\"${img.src}\"]`\n    );\n\n    if (!overlay) {\n      overlay = document.createElement(\"div\");\n      overlay.className = \"image-overlay\";\n      overlay.dataset.forImage = img.src;\n      overlay.style.cssText = `\n        position: absolute;\n        width: 30px;\n        height: 30px;\n        background-color: rgba(255, 255, 255, 0.4);\n        border-radius: 50%;\n        cursor: pointer;\n        z-index: 2147483647;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 20px;\n        pointer-events: auto;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n        opacity: 0.5;\n        transition: opacity 0.3s ease, background-color 0.3s ease, display 0.3s ease;\n      `;\n      overlay.textContent = \"ðŸ§¿\";\n\n      overlay.onclick = (e) => {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const highestQualityUrl = getHighestQualityImageUrl(img);\n\n        if (highestQualityUrl) {\n          showConsentPopup(overlay, highestQualityUrl);\n        } else {\n          showMessage(\"No suitable image found.\", \"error\");\n        }\n      };\n\n      img.parentElement.appendChild(overlay);\n\n      overlay.addEventListener(\"mouseenter\", () => {\n        overlay.style.opacity = \"1\";\n        overlay.style.backgroundColor = \"rgba(255, 255, 255, 0.8)\";\n      });\n\n      overlay.addEventListener(\"mouseleave\", () => {\n        overlay.style.opacity = \"0.5\";\n        overlay.style.backgroundColor = \"rgba(255, 255, 255, 0.4)\";\n      });\n    }\n\n    const updateOverlayPosition = debounce(() => {\n      const rect = img.getBoundingClientRect();\n      const viewportHeight = window.innerHeight;\n      const viewportWidth = window.innerWidth;\n\n      const isPartiallyVisible =\n        rect.top < viewportHeight &&\n        rect.bottom > 0 &&\n        rect.left < viewportWidth &&\n        rect.right > 0;\n\n      const isSlideshow = img.closest(\".media-lightbox-img\") !== null;\n      const isVideo =\n        img.tagName.toLowerCase() === \"video\" || img.querySelector(\"video\");\n\n      if (\n        isPartiallyVisible &&\n        ((rect.width > 100 && rect.height > 100) || isVideo) &&\n        (!isSlideshow || img.offsetParent !== null)\n      ) {\n        overlay.style.display = \"flex\";\n        const top = 10;\n        const right = 10;\n        overlay.style.top = `${top}px`;\n        overlay.style.right = `${right}px`;\n        overlay.style.bottom = \"auto\";\n        overlay.style.left = \"auto\";\n      } else if (isVideo) {\n        overlay.style.display = \"flex\";\n        overlay.style.top = \"10px\";\n        overlay.style.right = \"10px\";\n        overlay.style.bottom = \"auto\";\n        overlay.style.left = \"auto\";\n      } else {\n        setTimeout(() => {\n          if (!isPartiallyVisible) {\n            overlay.style.display = \"none\";\n          }\n        }, 300); // 300ms delay before hiding\n      }\n    }, 100); // 100ms debounce\n\n    updateOverlayPosition();\n\n    if (!img.dataset.overlayEventListenersAdded) {\n      const scrollHandler = () => {\n        updateOverlayPosition();\n      };\n      const resizeHandler = () => {\n        updateOverlayPosition();\n      };\n      window.addEventListener(\"scroll\", scrollHandler, { passive: true });\n      window.addEventListener(\"resize\", resizeHandler, { passive: true });\n      img.dataset.overlayEventListenersAdded = \"true\";\n    }\n\n    const observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        if (\n          mutation.type === \"attributes\" &&\n          (mutation.attributeName === \"src\" ||\n            mutation.attributeName === \"style\")\n        ) {\n          overlay.dataset.forImage = img.src;\n          updateOverlayPosition();\n        }\n      });\n    });\n\n    observer.observe(img, {\n      attributes: true,\n      attributeFilter: [\"src\", \"style\"],\n    });\n  }\n\n  // Show consent popup before sending image for analysis\n  function showConsentPopup(target, imageUrl) {\n    const existingPopups = document.querySelectorAll(\".consent-popup\");\n    existingPopups.forEach((popup) => {\n      popup.remove();\n    });\n\n    const popup = document.createElement(\"div\");\n    popup.className = \"consent-popup\";\n    popup.innerHTML = `\n      <p class=\"consent-message\">Do you want to send this image for analysis?</p>\n      <div class=\"consent-buttons\">\n        <button class=\"confirm-btn\">Analyze Image</button>\n        <button class=\"cancel-btn\">Cancel</button>\n      </div>\n      <div class=\"loading-indicator\" style=\"display: none;\">\n        <div class=\"spinner\"></div>\n        <p>Analyzing image...</p>\n      </div>\n      <div class=\"analysis-results\" style=\"display: none;\"></div>\n    `;\n\n    popup.style.position = \"fixed\";\n    popup.style.zIndex = \"2147483647\";\n\n    document.body.appendChild(popup);\n\n    const updatePopupPosition = () => {\n      const rect = target.getBoundingClientRect();\n      const viewportWidth = window.innerWidth;\n      const viewportHeight = window.innerHeight;\n      const popupHeight = popup.offsetHeight;\n      const popupWidth = popup.offsetWidth;\n\n      const isInView =\n        rect.top < viewportHeight &&\n        rect.bottom > 0 &&\n        rect.left < viewportWidth &&\n        rect.right > 0;\n\n      if (!isInView) {\n        popup.style.display = \"none\";\n        return;\n      }\n\n      popup.style.display = \"block\";\n\n      let top, left;\n\n      if (rect.bottom + popupHeight + 10 <= viewportHeight) {\n        top = rect.bottom + 10;\n      } else if (rect.top - popupHeight - 10 >= 0) {\n        top = rect.top - popupHeight - 10;\n      } else {\n        top = Math.max(\n          10,\n          Math.min(rect.top, viewportHeight - popupHeight - 10)\n        );\n      }\n\n      left = Math.max(10, Math.min(rect.left, viewportWidth - popupWidth - 10));\n\n      popup.style.top = `${top}px`;\n      popup.style.left = `${left}px`;\n    };\n    updatePopupPosition();\n\n    const updateHandler = () => {\n      updatePopupPosition();\n    };\n    window.addEventListener(\"scroll\", updateHandler, { passive: true });\n    window.addEventListener(\"resize\", updateHandler, { passive: true });\n\n    const confirmBtn = popup.querySelector(\".confirm-btn\");\n    const cancelBtn = popup.querySelector(\".cancel-btn\");\n    const loadingIndicator = popup.querySelector(\".loading-indicator\");\n    const analysisResults = popup.querySelector(\".analysis-results\");\n    const consentMessage = popup.querySelector(\".consent-message\");\n\n    const handleConfirm = () => {\n      consentMessage.style.display = \"none\";\n      popup.querySelector(\".consent-buttons\").style.display = \"none\";\n      loadingIndicator.style.display = \"block\";\n      sendImageForAnalysis(imageUrl, popup);\n    };\n\n    const handleCancel = (e) => {\n      removePopup();\n    };\n\n    const handleOutsideClick = (e) => {\n      if (!popup.contains(e.target) && e.target !== target) {\n        removePopup();\n      }\n    };\n\n    const removePopup = () => {\n      popup.remove();\n      confirmBtn.removeEventListener(\"click\", handleConfirm);\n      cancelBtn.removeEventListener(\"click\", handleCancel);\n      document.removeEventListener(\"click\", handleOutsideClick);\n      window.removeEventListener(\"scroll\", updateHandler);\n      window.removeEventListener(\"resize\", updateHandler);\n    };\n\n    confirmBtn.addEventListener(\"click\", handleConfirm);\n    cancelBtn.addEventListener(\"click\", handleCancel);\n    document.addEventListener(\"click\", handleOutsideClick);\n  }\n\n  // Send image data for analysis\n  function sendImageForAnalysis(url, popup) {\n    let filename = url.split(\"/\").pop().split(\"?\")[0];\n    let mimeType = \"image/jpeg\"; // Default to JPEG for Twitter images\n\n    if (url.includes(\"twimg.com\")) {\n      // For Twitter images, extract format from URL\n      const format = new URL(url).searchParams.get(\"format\");\n      if (format) {\n        filename += `.${format}`;\n        mimeType = `image/${format}`;\n      }\n    } else {\n      mimeType = getMimeType(filename);\n    }\n\n    console.log(`Sending image for analysis: ${filename}`);\n    console.log(`MIME type: ${mimeType}`);\n    console.log(`Image URL: ${url}`);\n\n    fetch(url)\n      .then((response) => {\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        return response.arrayBuffer();\n      })\n      .then((arrayBuffer) => {\n        const uint8Array = new Uint8Array(arrayBuffer);\n        return crypto.subtle\n          .digest(\"SHA-256\", uint8Array)\n          .then((hashBuffer) => {\n            const hashArray = Array.from(new Uint8Array(hashBuffer));\n            const hashHex = hashArray\n              .map((b) => b.toString(16).padStart(2, \"0\"))\n              .join(\"\");\n            return { uint8Array, hashHex };\n          });\n      })\n      .then(({ uint8Array, hashHex }) => {\n        chrome.runtime.sendMessage(\n          {\n            action: \"sendImage\",\n            imageData: {\n              url,\n              mimeType,\n              filename,\n              size: uint8Array.length,\n              sample: Array.from(uint8Array.slice(0, 16)),\n              sha256Hash: hashHex,\n              origin: window.location.origin, // Add this line\n            },\n          },\n          (response) => {\n            if (chrome.runtime.lastError) {\n              console.error(\"Error sending message:\", chrome.runtime.lastError);\n              displayAnalysisResults(\n                popup,\n                \"Error: \" + chrome.runtime.lastError.message,\n                \"error\"\n              );\n            } else if (response.error === \"Authentication required\") {\n              displayAnalysisResults(\n                popup,\n                \"Authentication required. Please log in and try again.\",\n                \"error\"\n              );\n            } else {\n              console.log(\"Server response:\", response);\n              displayAnalysisResults(popup, response, \"success\");\n            }\n          }\n        );\n      })\n      .catch((error) => {\n        console.error(\"Error:\", error);\n        displayAnalysisResults(popup, \"Error: \" + error.message, \"error\");\n      });\n  }\n\n  function displayAnalysisResults(popup, results, status) {\n    const loadingIndicator = popup.querySelector(\".loading-indicator\");\n    const analysisResults = popup.querySelector(\".analysis-results\");\n\n    loadingIndicator.style.display = \"none\";\n    analysisResults.style.display = \"block\";\n\n    if (status === \"error\") {\n      analysisResults.innerHTML = `<p class=\"error\">${results}</p>`;\n    } else {\n      // Create a table with the results\n      let tableRows = \"\";\n      for (const [key, value] of Object.entries(results)) {\n        tableRows += `\n          <tr>\n            <td>${key}</td>\n            <td>${\n              typeof value === \"object\" ? JSON.stringify(value) : value\n            }</td>\n          </tr>\n        `;\n      }\n\n      analysisResults.innerHTML = `\n        <h3>Analysis Results</h3>\n        <table class=\"results-table\">\n          <tbody>\n            ${tableRows}\n          </tbody>\n        </table>\n      `;\n    }\n  }\n\n  // Helper function to get MIME type from filename\n  function getMimeType(filename) {\n    const ext = filename.split(\".\").pop().toLowerCase();\n    const mimeTypes = {\n      jpg: \"image/jpeg\",\n      jpeg: \"image/jpeg\",\n      png: \"image/png\",\n      gif: \"image/gif\",\n      webp: \"image/webp\",\n    };\n    return mimeTypes[ext] || \"application/octet-stream\";\n  }\n\n  // Get the highest quality image URL\n  function getHighestQualityImageUrl(img) {\n    if (currentSite === \"instagram\") {\n      // Try to get the image data from the loaded image\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = img.naturalWidth;\n      canvas.height = img.naturalHeight;\n      const ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(img, 0, 0);\n      try {\n        return canvas.toDataURL(\"image/jpeg\");\n      } catch (e) {\n        console.error(\"Failed to get image data:\", e);\n        // Fall back to the original src if we can't get the data URL\n        return img.src;\n      }\n    }\n\n    const originalSrc = img.src;\n    let highQualityUrl = originalSrc;\n\n    if (currentSite === \"linkedin\") {\n      const isCertificationImage =\n        img.closest(\".feed-shared-celebration-image\") !== null;\n\n      if (isCertificationImage) {\n        return originalSrc;\n      }\n\n      try {\n        const parsedUrl = new URL(originalSrc);\n        const pathname = parsedUrl.pathname;\n\n        // Remove size parameters\n        parsedUrl.searchParams.delete(\"w\");\n        parsedUrl.searchParams.delete(\"h\");\n\n        // Set to highest quality\n        parsedUrl.searchParams.set(\"w\", \"1000\");\n        parsedUrl.searchParams.set(\"h\", \"1000\");\n\n        highQualityUrl = parsedUrl.toString();\n\n        // Preserve the original file extension if it exists\n        const originalExtension = pathname.split(\".\").pop().toLowerCase();\n        if ([\"jpg\", \"jpeg\", \"png\", \"gif\", \"webp\"].includes(originalExtension)) {\n          if (!highQualityUrl.toLowerCase().endsWith(`.${originalExtension}`)) {\n            highQualityUrl += `.${originalExtension}`;\n          }\n        }\n      } catch (error) {\n        console.error(\"Failed to parse LinkedIn image URL:\", error);\n        highQualityUrl = originalSrc;\n      }\n    } else if (currentSite === \"instagram\") {\n      if (originalSrc.includes(\"&_nc_ht=\")) {\n        try {\n          const url = new URL(originalSrc);\n          url.searchParams.delete(\"_nc_sid\");\n          url.searchParams.delete(\"_nc_ohc\");\n          url.searchParams.delete(\"_nc_ht\");\n          url.searchParams.delete(\"edm\");\n          url.searchParams.delete(\"oh\");\n          url.searchParams.delete(\"oe\");\n          highQualityUrl = url.toString();\n        } catch (error) {\n          console.error(\"Failed to parse Instagram image URL:\", error);\n        }\n      }\n    }\n\n    return highQualityUrl;\n  }\n\n  // Show message to user\n  function showMessage(message, type) {\n    const messageDiv = document.createElement(\"div\");\n    messageDiv.textContent = message;\n    messageDiv.style.position = \"fixed\";\n    messageDiv.style.bottom = \"20px\";\n    messageDiv.style.right = \"20px\";\n    messageDiv.style.padding = \"10px 20px\";\n    messageDiv.style.borderRadius = \"5px\";\n    messageDiv.style.color = \"#fff\";\n    messageDiv.style.zIndex = \"10000\";\n    messageDiv.style.boxShadow = \"0 2px 8px rgba(0, 0, 0, 0.2)\";\n    messageDiv.style.opacity = \"0\";\n    messageDiv.style.transition = \"opacity 0.5s ease-in-out\";\n\n    if (type === \"success\") {\n      messageDiv.style.backgroundColor = \"#4caf50\";\n    } else if (type === \"error\") {\n      messageDiv.style.backgroundColor = \"#f44336\";\n    } else {\n      messageDiv.style.backgroundColor = \"#333\";\n    }\n\n    document.body.appendChild(messageDiv);\n\n    void messageDiv.offsetWidth;\n\n    messageDiv.style.opacity = \"1\";\n\n    setTimeout(() => {\n      messageDiv.style.opacity = \"0\";\n      messageDiv.addEventListener(\"transitionend\", () => {\n        messageDiv.remove();\n      });\n    }, 3000);\n  }\n\n  // Debounced version of addOrUpdateOverlayToImages\n  const debouncedAddOrUpdateOverlayToImages = debounce(\n    addOrUpdateOverlayToImages,\n    500\n  );\n\n  // Handle DOM changes\n  function handleDOMChanges(mutationsList) {\n    for (const mutation of mutationsList) {\n      if (mutation.type === \"childList\" || mutation.type === \"attributes\") {\n        if (\n          mutation.addedNodes.length > 0 ||\n          (mutation.type === \"attributes\" && mutation.attributeName === \"src\")\n        ) {\n          clearTimeout(debounceTimer);\n          debounceTimer = setTimeout(() => {\n            addOrUpdateOverlayToImages();\n          }, DEBOUNCE_DELAY);\n          break;\n        }\n      }\n    }\n  }\n\n  // Set up observers for DOM changes\n  function setupObservers() {\n    bodyObserver = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        if (mutation.type === \"childList\") {\n          mutation.addedNodes.forEach((node) => {\n            if (node.nodeType === Node.ELEMENT_NODE) {\n              const images = node.querySelectorAll(\n                \"img:not([data-overlay-processed])\"\n              );\n              images.forEach((img, index) => processImage(img, index));\n            }\n          });\n        }\n      });\n    });\n\n    bodyObserver.observe(document.body, { childList: true, subtree: true });\n\n    setInterval(checkForNewImages, 2000);\n\n    window.addEventListener(\n      \"scroll\",\n      debounce(() => {\n        addOrUpdateOverlayToImages();\n      }, 200)\n    );\n\n    observer = new MutationObserver(handleDOMChanges);\n    observer.observe(document.body, { childList: true, subtree: true });\n  }\n\n  // Disconnect observers\n  function disconnectObservers() {\n    if (bodyObserver) {\n      bodyObserver.disconnect();\n    }\n    if (observer) {\n      observer.disconnect();\n    }\n\n    window.removeEventListener(\"scroll\", debouncedAddOrUpdateOverlayToImages);\n  }\n\n  // Check for new images periodically\n  function checkForNewImages() {\n    const images = document.querySelectorAll(\n      \"img:not([data-overlay-processed])\"\n    );\n    images.forEach((img, index) => processImage(img, index));\n  }\n\n  // Watch for changes in certification images\n  function watchCertificationImage(container) {\n    const observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        if (mutation.type === \"childList\") {\n          const addedNodes = Array.from(mutation.addedNodes);\n          const removedNodes = Array.from(mutation.removedNodes);\n\n          const addedImage = addedNodes.find((node) => node.tagName === \"IMG\");\n          const removedImage = removedNodes.find(\n            (node) => node.tagName === \"IMG\"\n          );\n\n          if (addedImage) {\n            processImage(addedImage, \"certification\");\n          }\n\n          if (removedImage) {\n            const overlay = container.querySelector(\".image-overlay\");\n            if (overlay) {\n              overlay.remove();\n            }\n          }\n        }\n      });\n    });\n\n    observer.observe(container, { childList: true, subtree: true });\n  }\n\n  // Check if the extension is still valid\n  function checkExtensionValidity() {\n    if (!chrome.runtime.id) {\n      location.reload();\n    }\n  }\n\n  setInterval(checkExtensionValidity, 60000);\n\n  // Initialize overlay\n  async function initializeOverlay() {\n    const shouldProcess = await shouldProcessImage();\n    if (shouldProcess) {\n      addOrUpdateOverlayToImages();\n    }\n  }\n\n  // Set up the extension\n  async function setupExtension() {\n    if (!chrome.runtime || !chrome.runtime.id) {\n      return;\n    }\n\n    const hostname = window.location.hostname;\n    if (hostname.includes(\"linkedin.com\")) currentSite = \"linkedin\";\n    else if (hostname.includes(\"facebook.com\")) currentSite = \"facebook\";\n    else if (hostname.includes(\"twitter.com\") || hostname.includes(\"x.com\"))\n      currentSite = \"twitter\";\n    else if (hostname.includes(\"instagram.com\")) currentSite = \"instagram\";\n    else if (hostname.includes(\"reddit.com\")) currentSite = \"reddit\";\n    else currentSite = null;\n\n    if (currentSite) {\n      const shouldProcess = await shouldProcessImage();\n      if (shouldProcess) {\n        extensionEnabled = true;\n        siteEnabled = true;\n        initializeOverlay();\n        setupObservers();\n      } else {\n        disableExtension();\n      }\n    }\n  }\n\n  // Disable the extension\n  function disableExtension() {\n    extensionEnabled = false;\n    siteEnabled = false;\n    removeAllOverlays();\n    disconnectObservers();\n  }\n\n  // Handle settings updates\n  function handleSettingsUpdate(settings) {\n    extensionEnabled = settings.enableOverlay !== false;\n    siteEnabled = settings[currentSite] !== false;\n\n    if (!extensionEnabled || !siteEnabled) {\n      hideAllOverlays();\n    } else {\n      showAllOverlays();\n      addOrUpdateOverlayToImages();\n    }\n  }\n\n  // Hide all overlays\n  function hideAllOverlays() {\n    const overlays = document.querySelectorAll(\".image-overlay\");\n    overlays.forEach((overlay) => {\n      overlay.style.display = \"none\";\n    });\n  }\n\n  // Show all overlays\n  function showAllOverlays() {\n    const overlays = document.querySelectorAll(\".image-overlay\");\n    overlays.forEach((overlay) => {\n      overlay.style.display = \"flex\";\n    });\n  }\n\n  // Message listener for chrome runtime messages\n  chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\n    console.log(\"Message received in social content script:\", request);\n    if (request.action === \"settingsChanged\") {\n      console.log(\"Settings changed:\", request.changes);\n      // Update your content script's behavior based on the new settings\n      // For example:\n      updateSettings(request.changes);\n      sendResponse({ success: true });\n    }\n    if (request.action === \"updateSettings\") {\n      handleSettingsUpdate(request.settings);\n      sendResponse({ status: \"Settings updated\" });\n    }\n    return true; // Indicates that the response is sent asynchronously\n  });\n\n  function updateSettings(changes) {\n    // Implement this function to update your content script's behavior\n    // based on the changed settings\n    console.log(\"Updating settings in content script:\", changes);\n    // Example:\n    if (changes.enableOverlay) {\n      extensionEnabled = changes.enableOverlay.newValue;\n    }\n    // Update other settings as needed\n    setupExtension(); // Re-run your setup function with the new settings\n  }\n\n  // Initialize the extension\n  setupExtension();\n\n  // Add CSS rules\n  const cssRules = `\n    .overlay:state(secondary-text-color) {\n      color: var(--secondary-text-color);\n    }\n    \n    .image-fill:state(webkit-fill-available) {\n      width: -webkit-fill-available;\n    }\n  `;\n\n  const style = document.createElement(\"style\");\n  style.innerHTML = cssRules;\n  document.head.appendChild(style);\n\n  // Create image overlay\n  function createImageOverlay(imageElement) {\n    const overlay = document.createElement(\"div\");\n    overlay.className = \"image-overlay\";\n\n    let isOpen = false;\n\n    overlay.addEventListener(\"click\", () => {\n      isOpen = !isOpen;\n      if (isOpen) {\n        const details = document.createElement(\"div\");\n        details.className = \"overlay-details\";\n        details.textContent = \"Image Details\";\n        overlay.appendChild(details);\n      } else {\n        const details = overlay.querySelector(\".overlay-details\");\n        if (details) {\n          details.remove();\n        }\n      }\n    });\n\n    imageElement.parentElement.appendChild(overlay);\n  }\n\n  // Add overlay to image\n  function addOverlay(imageElement, index) {\n    if (imageElement.getAttribute(\"aria-hidden\") === \"true\") {\n      imageElement.removeAttribute(\"aria-hidden\");\n    }\n\n    createImageOverlay(imageElement);\n  }\n\n  // Debounce timer and delay\n  let debounceTimer;\n  const DEBOUNCE_DELAY = 300;\n\n  // Log errors\n  function logError(error) {\n    console.error(\"RealEyes.ai Extension Error:\", error);\n    // Additional logging mechanisms can be added here\n  }\n\n  // Global error event listener\n  window.addEventListener(\"error\", (event) => {\n    logError(event.error);\n  });\n\n  const getValidOrigin = () => {\n    const currentOrigin = window.location.origin;\n    if (allowedOrigins.includes(currentOrigin)) {\n      return currentOrigin;\n    }\n    return null;\n  };\n})();\n"],"names":["debounce","func","wait","timeout","args","clearTimeout","setTimeout","console","log","bodyObserver","observer","extensionEnabled","siteEnabled","currentSite","removeAllOverlays","document","querySelectorAll","forEach","overlay","remove","async","shouldProcessImage","items","Promise","resolve","reject","chrome","storage","sync","get","runtime","lastError","enableOverlay","error","addOrUpdateOverlayToImages","allImages","traverse","node","nodeType","Node","ELEMENT_NODE","tagName","toLowerCase","dataset","overlayProcessed","push","shadowRoot","childNodes","child","body","img","index","width","height","getAttribute","classList","contains","complete","naturalWidth","processImage","addEventListener","once","IntersectionObserver","entries","entry","isIntersecting","addOrUpdateOverlayToImage","unobserve","threshold","observe","onerror","onload","querySelector","src","createElement","className","forImage","style","cssText","textContent","onclick","e","stopPropagation","preventDefault","highestQualityUrl","canvas","naturalHeight","getContext","drawImage","toDataURL","originalSrc","highQualityUrl","closest","parsedUrl","URL","pathname","searchParams","delete","set","toString","originalExtension","split","pop","includes","endsWith","url","getHighestQualityImageUrl","target","imageUrl","popup","innerHTML","position","zIndex","appendChild","updatePopupPosition","rect","getBoundingClientRect","viewportWidth","window","innerWidth","viewportHeight","innerHeight","popupHeight","offsetHeight","popupWidth","offsetWidth","top","bottom","left","right","display","Math","max","min","updateHandler","passive","confirmBtn","cancelBtn","loadingIndicator","consentMessage","handleConfirm","filename","mimeType","format","jpg","jpeg","png","gif","webp","getMimeType","fetch","then","response","ok","Error","status","arrayBuffer","uint8Array","Uint8Array","crypto","subtle","digest","hashBuffer","hashHex","Array","from","map","b","padStart","join","sendMessage","action","imageData","size","length","sample","slice","sha256Hash","origin","location","displayAnalysisResults","message","catch","sendImageForAnalysis","handleCancel","removePopup","handleOutsideClick","removeEventListener","showConsentPopup","messageDiv","padding","borderRadius","color","boxShadow","opacity","transition","backgroundColor","showMessage","parentElement","updateOverlayPosition","isPartiallyVisible","isSlideshow","isVideo","offsetParent","overlayEventListenersAdded","scrollHandler","resizeHandler","MutationObserver","mutations","mutation","type","attributeName","attributes","attributeFilter","results","analysisResults","tableRows","key","value","Object","JSON","stringify","debouncedAddOrUpdateOverlayToImages","handleDOMChanges","mutationsList","addedNodes","debounceTimer","DEBOUNCE_DELAY","checkForNewImages","setupExtension","id","hostname","initializeOverlay","childList","subtree","setInterval","disconnect","reload","onMessage","addListener","request","sender","sendResponse","changes","newValue","success","settings","head","event"],"sourceRoot":""}